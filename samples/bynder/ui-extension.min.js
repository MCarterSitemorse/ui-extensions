var UiExtension=function(e){"use strict";function t(e,t,i){if("undefined"!=typeof Symbol){var a=Symbol.iterator;if(a&&a in e){var c,s,l,u=e[a]();if(function e(a){try{for(;!((c=u.next()).done||i&&i());)if((a=t(c.value))&&a.then){if(!n(a))return void a.then(e,l||(l=o.bind(null,s=new r,2)));a=a.v}s?o(s,1,a):s=a}catch(e){o(s||(s=new Pact),2,e)}}(),u.return){var d=function(e){try{c.done||u.return()}catch(e){}return e};if(s&&s.then)return s.then(d,function(e){throw d(e)});d()}return s}}if(!("length"in e))throw new TypeError("value is not iterable");for(var h=[],f=0;f<e.length;f++)h.push(e[f]);return function(e,t,i){var a,c,s=-1;return function l(u){try{for(;++s<e.length&&(!i||!i());)if((u=t(s))&&u.then){if(!n(u))return void u.then(l,c||(c=o.bind(null,a=new r,2)));u=u.v}a?o(a,1,u):a=u}catch(e){o(a||(a=new Pact),2,e)}}(),a}(h,function(e){return t(h[e])},i)}function n(e){return e instanceof r&&1&e.s}function r(){}function o(e,t,n){if(!e.s){if(n instanceof r){if(!n.s)return void(n.o=o.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(o.bind(null,e,t),o.bind(null,e,2));e.s=t,e.v=n;const i=e.o;i&&i(e)}}r.prototype.then=function(e,t){const n=new r,i=this.s;if(i){const r=1&i?e:t;if(r){try{o(n,1,r(this.v))}catch(e){o(n,2,e)}return n}return this}return this.o=function(r){try{const i=r.v;1&r.s?o(n,1,e?e(i):i):t?o(n,1,t(i)):o(n,2,i)}catch(e){o(n,2,e)}},n};const i=new WeakMap,a=new WeakMap,c=Promise.resolve();function s(e){if("string"!=typeof e)throw new TypeError("eventName must be a string")}function l(e){if("function"!=typeof e)throw new TypeError("listener must be a function")}function u(e,t){const n=a.get(e);return n.has(t)||n.set(t,new Set),n.get(t)}class d{constructor(){i.set(this,new Set),a.set(this,new Map)}on(e,t){return s(e),l(t),u(this,e).add(t),this.off.bind(this,e,t)}off(e,t){s(e),l(t),u(this,e).delete(t)}once(e){return new Promise(t=>{s(e);const n=this.on(e,e=>{n(),t(e)})})}emit(e,t){try{const n=this;s(e);const r=u(n,e),o=i.get(n),a=[...r],l=[...o];return Promise.resolve(c).then(function(){return Promise.all([...a.map(function(e){try{return r.has(e)?Promise.resolve(e(t)):void 0}catch(e){return Promise.reject(e)}}),...l.map(function(n){try{return o.has(n)?Promise.resolve(n(e,t)):void 0}catch(e){return Promise.reject(e)}})])})}catch(e){return Promise.reject(e)}}emitSerial(e,n){try{const r=this;s(e);const o=u(r,e),a=i.get(r),l=[...o],d=[...a];return Promise.resolve(c).then(function(){function r(){return t(d,function(t){const r=function(){if(a.has(t))return Promise.resolve(t(e,n)).then(function(){})}();if(r&&r.then)return r.then(function(){})})}const i=t(l,function(e){const t=function(){if(o.has(e))return Promise.resolve(e(n)).then(function(){})}();if(t&&t.then)return t.then(function(){})});return i&&i.then?i.then(r):r()})}catch(e){return Promise.reject(e)}}onAny(e){return l(e),i.get(this).add(e),this.offAny.bind(this,e)}offAny(e){l(e),i.get(this).delete(e)}clearListeners(e){if("string"==typeof e)u(this,e).clear();else{i.get(this).clear();for(const e of a.get(this).values())e.clear()}}listenerCount(e){if("string"==typeof e)return i.get(this).size+u(this,e).size;void 0!==e&&s(e);let t=i.get(this).size;for(const e of a.get(this).values())t+=e.size;return t}}d.Typed=class extends d{},Object.defineProperty(d.Typed,"Typed",{enumerable:!1,value:void 0});var h=d;var f,m,p,v,E,g,y,w,C=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM=t.ERR_NOT_IN_IFRAME=t.ERR_CONNECTION_TIMEOUT=t.ERR_CONNECTION_DESTROYED=void 0,t.ERR_CONNECTION_DESTROYED="ConnectionDestroyed",t.ERR_CONNECTION_TIMEOUT="ConnectionTimeout",t.ERR_NOT_IN_IFRAME="NotInIframe",t.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM="IframeAlreadyAttachedToDom";var n,r={"http:":"80","https:":"443"},o=/^(https?:|file:)?\/\/([^\/:]+)?(:(\d+))?/,i={ERR_CONNECTION_DESTROYED:"ConnectionDestroyed",ERR_CONNECTION_TIMEOUT:"ConnectionTimeout",ERR_NOT_IN_IFRAME:"NotInIframe",ERR_IFRAME_ALREADY_ATTACHED_TO_DOM:"IframeAlreadyAttachedToDom",Promise:function(){try{return window?window.Promise:null}catch(e){return null}}(),debug:!1},a=(n=0,function(){return++n}),c=function(){if(i.debug){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["[Penpal]"].concat(n))}},s=function(e){var t=[];return e(function(){t.forEach(function(e){e()})}),{then:function(e){t.push(e)}}},l=function(e){return{name:e.name,message:e.message,stack:e.stack}},u=function(e,t,n,r,o){var s=t.localName,l=t.local,u=t.remote,d=t.remoteOrigin,h=!1;c("".concat(s,": Connecting call sender"));var f=function(e){return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if(c("".concat(s,": Sending ").concat(e,"() call")),u.closed&&r(),h){var f=new Error("Unable to send ".concat(e,"() call due ")+"to destroyed connection");throw f.code="ConnectionDestroyed",f}return new i.Promise(function(t,r){var o=a();l.addEventListener("message",function n(i){if(i.source===u&&i.origin===d&&"reply"===i.data.penpal&&i.data.id===o){c("".concat(s,": Received ").concat(e,"() reply")),l.removeEventListener("message",n);var a=i.data.returnValue;i.data.returnValueIsError&&(h=a,f=new Error,Object.keys(h).forEach(function(e){return f[e]=h[e]}),a=f),("fulfilled"===i.data.resolution?t:r)(a)}var h,f}),u.postMessage({penpal:"call",id:o,methodName:e,args:n},d)})}};o.then(function(){h=!0}),n.reduce(function(e,t){return e[t]=f(t),e},e)},d=function(e,t,n){var r=e.localName,o=e.local,a=e.remote,s=e.remoteOrigin,u=!1;c("".concat(r,": Connecting call receiver"));var d=function(e){if(e.source===a&&e.origin===s&&"call"===e.data.penpal){var n=e.data,o=n.methodName,d=n.args,h=n.id;if(c("".concat(r,": Received ").concat(o,"() call")),o in t){var f=function(e){return function(t){if(c("".concat(r,": Sending ").concat(o,"() reply")),u)c("".concat(r,": Unable to send ").concat(o,"() reply due to destroyed connection"));else{var n={penpal:"reply",id:h,resolution:e,returnValue:t};"rejected"===e&&t instanceof Error&&(n.returnValue=l(t),n.returnValueIsError=!0);try{a.postMessage(n,s)}catch(e){throw"DataCloneError"===e.name&&a.postMessage({penpal:"reply",id:h,resolution:"rejected",returnValue:l(e),returnValueIsError:!0},s),e}}}};new i.Promise(function(e){return e(t[o].apply(t,d))}).then(f("fulfilled"),f("rejected"))}}};o.addEventListener("message",d),n.then(function(){u=!0,o.removeEventListener("message",d)})};i.connectToChild=function(e){var t,n=e.url,a=e.appendTo,l=e.iframe,h=e.methods,f=void 0===h?{}:h,m=e.timeout;if(l&&l.parentNode){var p=new Error("connectToChild() must not be called with an iframe already attached to DOM");throw p.code="IframeAlreadyAttachedToDom",p}var v=new s(function(e){t=e}),E=window;(l=l||document.createElement("iframe")).src=n;var g=function(e){var t,n,i,a=document.location,c=o.exec(e);if(c?(t=c[1]?c[1]:a.protocol,n=c[2],i=c[4]):(t=a.protocol,n=a.hostname,i=a.port),"file:"===t)return"null";var s=i&&i!==r[t]?":".concat(i):"";return"".concat(t,"//").concat(n).concat(s)}(n);return{promise:new i.Promise(function(e,n){var r;void 0!==m&&(r=setTimeout(function(){var e=new Error("Connection to child timed out after ".concat(m,"ms"));e.code="ConnectionTimeout",n(e),t()},m));var o,i,h={},p=function(n){var a=l.contentWindow;if(n.source===a&&n.origin===g&&"handshake"===n.data.penpal){c("Parent: Received handshake, sending reply");var m="null"===n.origin?"*":n.origin;n.source.postMessage({penpal:"handshake-reply",methodNames:Object.keys(f)},m);var p={localName:"Parent",local:E,remote:a,remoteOrigin:m};i&&i();var y=new s(function(e){v.then(e),i=e});d(p,f,y),o&&o.forEach(function(e){delete h[e]}),o=n.data.methodNames,u(h,p,o,t,v),clearTimeout(r),e(h)}};E.addEventListener("message",p),c("Parent: Loading iframe"),(a||document.body).appendChild(l);var y=setInterval(function(){document.contains(l)||(clearInterval(y),t())},6e4);v.then(function(){l.parentNode&&l.parentNode.removeChild(l),E.removeEventListener("message",p),clearInterval(y);var e=new Error("Connection destroyed");e.code="ConnectionDestroyed",n(e)})}),iframe:l,destroy:t}},i.connectToParent=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.parentOrigin,r=void 0===n?"*":n,o=t.methods,a=void 0===o?{}:o,l=t.timeout;if(window===window.top){var h=new Error("connectToParent() must be called within an iframe");throw h.code="NotInIframe",h}var f=new s(function(t){e=t}),m=window,p=m.parent;return{promise:new i.Promise(function(t,n){var o;void 0!==l&&(o=setTimeout(function(){var t=new Error("Connection to parent timed out after ".concat(l,"ms"));t.code="ConnectionTimeout",n(t),e()},l));var i=function n(i){if(("*"===r||r===i.origin)&&i.source===p&&"handshake-reply"===i.data.penpal){c("Child: Received handshake reply"),m.removeEventListener("message",n);var s={localName:"Child",local:m,remote:p,remoteOrigin:i.origin},l={};d(s,a,f),u(l,s,i.data.methodNames,e,f),clearTimeout(o),t(l)}};m.addEventListener("message",i),f.then(function(){m.removeEventListener("message",i);var e=new Error("Connection destroyed");e.code="ConnectionDestroyed",n(e)}),c("Child: Sending handshake"),p.postMessage({penpal:"handshake",methodNames:Object.keys(a)},r)}),destroy:e}};var h=i;t.default=h}(f={exports:{}},f.exports),f.exports),O=(m=C)&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m;C.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM,C.ERR_NOT_IN_IFRAME,C.ERR_CONNECTION_TIMEOUT,C.ERR_CONNECTION_DESTROYED;(p=e.UiExtensionErrorCode||(e.UiExtensionErrorCode={})).ConnectionDestroyed="ConnectionDestroyed",p.DialogCanceled="DialogCanceled",p.DialogExists="DialogExists",p.IncompatibleParent="IncompatibleParent",p.InternalError="InternalError",p.NotInIframe="NotInIframe",(v=e.UiStyling||(e.UiStyling={})).Classic="classic",v.Material="material",(E=e.DocumentEditorMode||(e.DocumentEditorMode={})).View="view",E.Compare="compare",E.Edit="edit",(g=e.DialogSize||(e.DialogSize={})).Large="large",g.Medium="medium",g.Small="small";class T extends Error{constructor(e,t){super(t),this.code=e,this.message=t,Object.setPrototypeOf(this,new.target.prototype)}toPromise(){return Promise.reject(this)}static fromPenpal(e){const t=T.convertPenpalErrorCode(e);return new T(t,e.message)}static convertPenpalErrorCode(t){switch(t.code){case O.ERR_NOT_IN_IFRAME:return e.UiExtensionErrorCode.NotInIframe;case O.ERR_CONNECTION_DESTROYED:return e.UiExtensionErrorCode.ConnectionDestroyed;case"DialogCanceled":return e.UiExtensionErrorCode.DialogCanceled;case"DialogExists":return e.UiExtensionErrorCode.DialogExists;default:return e.UiExtensionErrorCode.InternalError}}}class _{constructor(e){this._parent=e}call(t,...n){if(!this._parent[t])return new T(e.UiExtensionErrorCode.IncompatibleParent,"missing ".concat(t,"()")).toPromise();try{return this._parent[t](...n).catch(_.convertPenpalError)}catch(e){return _.convertPenpalError(e)}}static convertPenpalError(e){return T.fromPenpal(e).toPromise()}}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const N="channel",b="".concat(N,".page"),D="".concat("document",".field"),I=Symbol("parent"),P=Symbol("eventEmitter"),A=Symbol("eventScope"),M=Symbol("fieldDomObserver"),x=Symbol("fieldOverflowStyle"),S=Symbol("fieldHeight"),L=27;function U(e,t,n){let r;Object.defineProperty(e,t,{get:()=>(void 0===r&&(r=n()),r),configurable:!1,enumerable:!0})}class j{constructor(e){this[I]=e}}class k extends j{constructor(e,t,n){super(e),this[P]=t,this[A]=n}on(e,t){return this[P].on("".concat(this[A],".").concat(e),t)}}class V extends k{get(){return this[I].call("getPage")}refresh(){return this[I].call("refreshPage")}}class F extends k{constructor(e,t,n){super(e,t,n),U(this,"page",()=>new V(e,t,b))}refresh(){return this[I].call("refreshChannel")}}class H extends j{constructor(e){super(e),U(this,"field",()=>new Y(this[I]))}get(){return this[I].call("getDocument")}}class Y extends j{constructor(e){super(e),this[y]=new MutationObserver(this.updateHeight.bind(this)),this[w]=null,window.addEventListener("focus",()=>e.call("emitEvent","".concat(D,".focus"))),window.addEventListener("blur",()=>e.call("emitEvent","".concat(D,".blur")))}getValue(){return this[I].call("getFieldValue")}getCompareValue(){return this[I].call("getFieldCompareValue")}setValue(e){return this[I].call("setFieldValue",e)}setHeight(e){return this[S]!==e&&(this[S]=null),this[I].call("setFieldHeight",e)}updateHeight(){const e=document.body.scrollHeight;if(this[S]!==e)return this[S]=e,this.setHeight(e)}autoUpdateHeight(){return this[M].observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),this[x]=document.body.style.overflowY,document.body.style.overflowY="hidden",()=>{this[M].disconnect(),document.body.style.overflowY=this[x]}}}y=M,w=S;class z extends j{constructor(e){super(e),window.addEventListener("keydown",({which:e})=>e===L&&this.cancel())}cancel(){return this[I].call("cancelDialog")}close(e){return this[I].call("closeDialog",e)}open(e){return this[I].call("openDialog",e)}options(){return this[I].call("getDialogOptions")}}class W extends j{constructor(e,t){super(e),U(this,"channel",()=>new F(e,t,N)),U(this,"dialog",()=>new z(e)),U(this,"document",()=>new H(e))}init(){return this[I].call("getProperties").then(e=>R(this,e))}}class q{static register(){const e=new URLSearchParams(window.location.search).get("br.parentOrigin"),t=new h;return function(e,t){try{return O.connectToParent({parentOrigin:e,methods:{emitEvent:t.emit.bind(t)}}).promise.then(e=>new _(e))}catch(e){return T.fromPenpal(e).toPromise()}}(e,t).then(e=>new W(e,t).init())}}const B=q.register;return e.default=q,e.register=B,e}({});
//# sourceMappingURL=ui-extension.min.js.map
