var UiExtension=function(e){"use strict";function t(e,t,i){if("undefined"!=typeof Symbol){var a=Symbol.iterator;if(a&&a in e){var s,c,l,u=e[a]();if(function e(a){try{for(;!((s=u.next()).done||i&&i());)if((a=t(s.value))&&a.then){if(!n(a))return void a.then(e,l||(l=o.bind(null,c=new r,2)));a=a.v}c?o(c,1,a):c=a}catch(e){o(c||(c=new Pact),2,e)}}(),u.return){var d=function(e){try{s.done||u.return()}catch(e){}return e};if(c&&c.then)return c.then(d,function(e){throw d(e)});d()}return c}}if(!("length"in e))throw new TypeError("value is not iterable");for(var h=[],f=0;f<e.length;f++)h.push(e[f]);return function(e,t,i){var a,s,c=-1;return function l(u){try{for(;++c<e.length&&(!i||!i());)if((u=t(c))&&u.then){if(!n(u))return void u.then(l,s||(s=o.bind(null,a=new r,2)));u=u.v}a?o(a,1,u):a=u}catch(e){o(a||(a=new Pact),2,e)}}(),a}(h,function(e){return t(h[e])},i)}function n(e){return e instanceof r&&1&e.s}function r(){}function o(e,t,n){if(!e.s){if(n instanceof r){if(!n.s)return void(n.o=o.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(o.bind(null,e,t),o.bind(null,e,2));e.s=t,e.v=n;const i=e.o;i&&i(e)}}r.prototype.then=function(e,t){const n=new r,i=this.s;if(i){const r=1&i?e:t;if(r){try{o(n,1,r(this.v))}catch(e){o(n,2,e)}return n}return this}return this.o=function(r){try{const i=r.v;1&r.s?o(n,1,e?e(i):i):t?o(n,1,t(i)):o(n,2,i)}catch(e){o(n,2,e)}},n};const i=new WeakMap,a=new WeakMap,s=Promise.resolve();function c(e){if("string"!=typeof e)throw new TypeError("eventName must be a string")}function l(e){if("function"!=typeof e)throw new TypeError("listener must be a function")}function u(e,t){const n=a.get(e);return n.has(t)||n.set(t,new Set),n.get(t)}class d{constructor(){i.set(this,new Set),a.set(this,new Map)}on(e,t){return c(e),l(t),u(this,e).add(t),this.off.bind(this,e,t)}off(e,t){c(e),l(t),u(this,e).delete(t)}once(e){return new Promise(t=>{c(e);const n=this.on(e,e=>{n(),t(e)})})}emit(e,t){try{const n=this;c(e);const r=u(n,e),o=i.get(n),a=[...r],l=[...o];return Promise.resolve(s).then(function(){return Promise.all([...a.map(function(e){try{return r.has(e)?Promise.resolve(e(t)):void 0}catch(e){return Promise.reject(e)}}),...l.map(function(n){try{return o.has(n)?Promise.resolve(n(e,t)):void 0}catch(e){return Promise.reject(e)}})])})}catch(e){return Promise.reject(e)}}emitSerial(e,n){try{const r=this;c(e);const o=u(r,e),a=i.get(r),l=[...o],d=[...a];return Promise.resolve(s).then(function(){function r(){return t(d,function(t){const r=function(){if(a.has(t))return Promise.resolve(t(e,n)).then(function(){})}();if(r&&r.then)return r.then(function(){})})}const i=t(l,function(e){const t=function(){if(o.has(e))return Promise.resolve(e(n)).then(function(){})}();if(t&&t.then)return t.then(function(){})});return i&&i.then?i.then(r):r()})}catch(e){return Promise.reject(e)}}onAny(e){return l(e),i.get(this).add(e),this.offAny.bind(this,e)}offAny(e){l(e),i.get(this).delete(e)}clearListeners(e){if("string"==typeof e)u(this,e).clear();else{i.get(this).clear();for(const e of a.get(this).values())e.clear()}}listenerCount(e){if("string"==typeof e)return i.get(this).size+u(this,e).size;void 0!==e&&c(e);let t=i.get(this).size;for(const e of a.get(this).values())t+=e.size;return t}}d.Typed=class extends d{},Object.defineProperty(d.Typed,"Typed",{enumerable:!1,value:void 0});var h=d;var f,m,v,p,E,g,y,w,C,O=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM=t.ERR_NOT_IN_IFRAME=t.ERR_CONNECTION_TIMEOUT=t.ERR_CONNECTION_DESTROYED=void 0,t.ERR_CONNECTION_DESTROYED="ConnectionDestroyed",t.ERR_CONNECTION_TIMEOUT="ConnectionTimeout",t.ERR_NOT_IN_IFRAME="NotInIframe",t.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM="IframeAlreadyAttachedToDom";var n,r={"http:":"80","https:":"443"},o=/^(https?:|file:)?\/\/([^\/:]+)?(:(\d+))?/,i={ERR_CONNECTION_DESTROYED:"ConnectionDestroyed",ERR_CONNECTION_TIMEOUT:"ConnectionTimeout",ERR_NOT_IN_IFRAME:"NotInIframe",ERR_IFRAME_ALREADY_ATTACHED_TO_DOM:"IframeAlreadyAttachedToDom",Promise:function(){try{return window?window.Promise:null}catch(e){return null}}(),debug:!1},a=(n=0,function(){return++n}),s=function(){if(i.debug){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["[Penpal]"].concat(n))}},c=function(e){var t=[];return e(function(){t.forEach(function(e){e()})}),{then:function(e){t.push(e)}}},l=function(e){return{name:e.name,message:e.message,stack:e.stack}},u=function(e,t,n,r,o){var c=t.localName,l=t.local,u=t.remote,d=t.remoteOrigin,h=!1;s("".concat(c,": Connecting call sender"));var f=function(e){return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if(s("".concat(c,": Sending ").concat(e,"() call")),u.closed&&r(),h){var f=new Error("Unable to send ".concat(e,"() call due ")+"to destroyed connection");throw f.code="ConnectionDestroyed",f}return new i.Promise(function(t,r){var o=a();l.addEventListener("message",function n(i){if(i.source===u&&i.origin===d&&"reply"===i.data.penpal&&i.data.id===o){s("".concat(c,": Received ").concat(e,"() reply")),l.removeEventListener("message",n);var a=i.data.returnValue;i.data.returnValueIsError&&(h=a,f=new Error,Object.keys(h).forEach(function(e){return f[e]=h[e]}),a=f),("fulfilled"===i.data.resolution?t:r)(a)}var h,f}),u.postMessage({penpal:"call",id:o,methodName:e,args:n},d)})}};o.then(function(){h=!0}),n.reduce(function(e,t){return e[t]=f(t),e},e)},d=function(e,t,n){var r=e.localName,o=e.local,a=e.remote,c=e.remoteOrigin,u=!1;s("".concat(r,": Connecting call receiver"));var d=function(e){if(e.source===a&&e.origin===c&&"call"===e.data.penpal){var n=e.data,o=n.methodName,d=n.args,h=n.id;if(s("".concat(r,": Received ").concat(o,"() call")),o in t){var f=function(e){return function(t){if(s("".concat(r,": Sending ").concat(o,"() reply")),u)s("".concat(r,": Unable to send ").concat(o,"() reply due to destroyed connection"));else{var n={penpal:"reply",id:h,resolution:e,returnValue:t};"rejected"===e&&t instanceof Error&&(n.returnValue=l(t),n.returnValueIsError=!0);try{a.postMessage(n,c)}catch(e){throw"DataCloneError"===e.name&&a.postMessage({penpal:"reply",id:h,resolution:"rejected",returnValue:l(e),returnValueIsError:!0},c),e}}}};new i.Promise(function(e){return e(t[o].apply(t,d))}).then(f("fulfilled"),f("rejected"))}}};o.addEventListener("message",d),n.then(function(){u=!0,o.removeEventListener("message",d)})};i.connectToChild=function(e){var t,n=e.url,a=e.appendTo,l=e.iframe,h=e.methods,f=void 0===h?{}:h,m=e.timeout;if(l&&l.parentNode){var v=new Error("connectToChild() must not be called with an iframe already attached to DOM");throw v.code="IframeAlreadyAttachedToDom",v}var p=new c(function(e){t=e}),E=window;(l=l||document.createElement("iframe")).src=n;var g=function(e){var t,n,i,a=document.location,s=o.exec(e);if(s?(t=s[1]?s[1]:a.protocol,n=s[2],i=s[4]):(t=a.protocol,n=a.hostname,i=a.port),"file:"===t)return"null";var c=i&&i!==r[t]?":".concat(i):"";return"".concat(t,"//").concat(n).concat(c)}(n);return{promise:new i.Promise(function(e,n){var r;void 0!==m&&(r=setTimeout(function(){var e=new Error("Connection to child timed out after ".concat(m,"ms"));e.code="ConnectionTimeout",n(e),t()},m));var o,i,h={},v=function(n){var a=l.contentWindow;if(n.source===a&&n.origin===g&&"handshake"===n.data.penpal){s("Parent: Received handshake, sending reply");var m="null"===n.origin?"*":n.origin;n.source.postMessage({penpal:"handshake-reply",methodNames:Object.keys(f)},m);var v={localName:"Parent",local:E,remote:a,remoteOrigin:m};i&&i();var y=new c(function(e){p.then(e),i=e});d(v,f,y),o&&o.forEach(function(e){delete h[e]}),o=n.data.methodNames,u(h,v,o,t,p),clearTimeout(r),e(h)}};E.addEventListener("message",v),s("Parent: Loading iframe"),(a||document.body).appendChild(l);var y=setInterval(function(){document.contains(l)||(clearInterval(y),t())},6e4);p.then(function(){l.parentNode&&l.parentNode.removeChild(l),E.removeEventListener("message",v),clearInterval(y);var e=new Error("Connection destroyed");e.code="ConnectionDestroyed",n(e)})}),iframe:l,destroy:t}},i.connectToParent=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.parentOrigin,r=void 0===n?"*":n,o=t.methods,a=void 0===o?{}:o,l=t.timeout;if(window===window.top){var h=new Error("connectToParent() must be called within an iframe");throw h.code="NotInIframe",h}var f=new c(function(t){e=t}),m=window,v=m.parent;return{promise:new i.Promise(function(t,n){var o;void 0!==l&&(o=setTimeout(function(){var t=new Error("Connection to parent timed out after ".concat(l,"ms"));t.code="ConnectionTimeout",n(t),e()},l));var i=function n(i){if(("*"===r||r===i.origin)&&i.source===v&&"handshake-reply"===i.data.penpal){s("Child: Received handshake reply"),m.removeEventListener("message",n);var c={localName:"Child",local:m,remote:v,remoteOrigin:i.origin},l={};d(c,a,f),u(l,c,i.data.methodNames,e,f),clearTimeout(o),t(l)}};m.addEventListener("message",i),f.then(function(){m.removeEventListener("message",i);var e=new Error("Connection destroyed");e.code="ConnectionDestroyed",n(e)}),s("Child: Sending handshake"),v.postMessage({penpal:"handshake",methodNames:Object.keys(a)},r)}),destroy:e}};var h=i;t.default=h}(f={exports:{}},f.exports),f.exports),T=(m=O)&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m;O.ERR_IFRAME_ALREADY_ATTACHED_TO_DOM,O.ERR_NOT_IN_IFRAME,O.ERR_CONNECTION_TIMEOUT,O.ERR_CONNECTION_DESTROYED;(v=e.UiExtensionErrorCode||(e.UiExtensionErrorCode={})).ConnectionDestroyed="ConnectionDestroyed",v.DialogCanceled="DialogCanceled",v.DialogExists="DialogExists",v.IncompatibleParent="IncompatibleParent",v.InternalError="InternalError",v.NotInIframe="NotInIframe",(p=e.UiStyling||(e.UiStyling={})).Classic="classic",p.Material="material",(E=e.DocumentEditorMode||(e.DocumentEditorMode={})).View="view",E.Compare="compare",E.Edit="edit",(g=e.DialogSize||(e.DialogSize={})).Large="large",g.Medium="medium",g.Small="small";class _ extends Error{constructor(e,t){super(t),this.code=e,this.message=t,Object.setPrototypeOf(this,new.target.prototype)}toPromise(){return Promise.reject(this)}static fromPenpal(e){const t=_.convertPenpalErrorCode(e);return new _(t,e.message)}static convertPenpalErrorCode(t){switch(t.code){case T.ERR_NOT_IN_IFRAME:return e.UiExtensionErrorCode.NotInIframe;case T.ERR_CONNECTION_DESTROYED:return e.UiExtensionErrorCode.ConnectionDestroyed;case"DialogCanceled":return e.UiExtensionErrorCode.DialogCanceled;case"DialogExists":return e.UiExtensionErrorCode.DialogExists;default:return e.UiExtensionErrorCode.InternalError}}}class b{constructor(e){this._parent=e}call(t,...n){if(!this._parent[t])return new _(e.UiExtensionErrorCode.IncompatibleParent,"missing ".concat(t,"()")).toPromise();try{return this._parent[t](...n).catch(b.convertPenpalError)}catch(e){return b.convertPenpalError(e)}}static convertPenpalError(e){return _.fromPenpal(e).toPromise()}}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const N="channel",P="".concat(N,".page"),D="".concat("document",".field"),I=Symbol("parent"),A=Symbol("eventEmitter"),M=Symbol("eventScope"),S=Symbol("fieldDomObserver"),x=Symbol("fieldOverflowStyle"),L=Symbol("fieldHeight"),j=Symbol("fieldHeightMode"),U=Symbol("fieldHeightListener"),k=27;function V(e,t,n){let r;Object.defineProperty(e,t,{get:()=>(void 0===r&&(r=n()),r),configurable:!1,enumerable:!0})}class F{constructor(e){this[I]=e}}class Y extends F{constructor(e,t,n){super(e),this[A]=t,this[M]=n}on(e,t){return this[A].on("".concat(this[M],".").concat(e),t)}}class H extends Y{get(){return this[I].call("getPage")}refresh(){return this[I].call("refreshPage")}}class z extends Y{constructor(e,t,n){super(e,t,n),V(this,"page",()=>new H(e,t,P))}refresh(){return this[I].call("refreshChannel")}}class W extends F{constructor(e){super(e),V(this,"field",()=>new B(this[I]))}get(){return this[I].call("getDocument")}}function q(e){if(this[L]!==e)return this[L]=e,this[I].call("setFieldHeight",e)}class B extends F{constructor(e){super(e),this[y]="manual",this[w]=(()=>q.call(this,document.body.scrollHeight)),this[C]=new MutationObserver(this[U]),window.addEventListener("focus",()=>e.call("emitEvent","".concat(D,".focus"))),window.addEventListener("blur",()=>e.call("emitEvent","".concat(D,".blur")))}getValue(){return this[I].call("getFieldValue")}getCompareValue(){return this[I].call("getFieldCompareValue")}setValue(e){return this[I].call("setFieldValue",e)}setHeight(e){return"auto"===e?function(){"auto"!==this[j]&&(document.body.addEventListener("load",this[U],!0),this[S].observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),this[j]="auto",this[x]=document.body.style.overflowY,document.body.style.overflowY="hidden")}.call(this)||Promise.resolve():(function(){"auto"===this[j]&&(document.body.removeEventListener("load",this[U],!0),this[S].disconnect(),this[j]="manual",document.body.style.overflowY=this[x])}.call(this),q.call(this,e)||Promise.resolve())}}y=j,w=U,C=S;class G extends F{constructor(e){super(e),window.addEventListener("keydown",({which:e})=>e===k&&this.cancel())}cancel(){return this[I].call("cancelDialog")}close(e){return this[I].call("closeDialog",e)}open(e){return this[I].call("openDialog",e)}options(){return this[I].call("getDialogOptions")}}class J extends F{constructor(e,t){super(e),V(this,"channel",()=>new z(e,t,N)),V(this,"dialog",()=>new G(e)),V(this,"document",()=>new W(e))}init(){return this[I].call("getProperties").then(e=>R(this,e))}}class K{static register(){const e=new URLSearchParams(window.location.search).get("br.parentOrigin"),t=new h;return function(e,t){try{return T.connectToParent({parentOrigin:e,methods:{emitEvent:t.emit.bind(t)}}).promise.then(e=>new b(e))}catch(e){return _.fromPenpal(e).toPromise()}}(e,t).then(e=>new J(e,t).init())}}const Q=K.register;return e.default=K,e.register=Q,e}({});
//# sourceMappingURL=ui-extension.min.js.map
